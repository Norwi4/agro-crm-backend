# Agro CRM Backend (Spring Boot + JdbcTemplate + PostgreSQL)

–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ —Ä–∞–±–æ—á–∏–π –±—ç–∫–µ–Ω–¥ –ø–æ–¥ –æ–ø–∏—Å–∞–Ω–∏–µ CRM –¥–ª—è –∞–≥—Ä–æ–±–∏–∑–Ω–µ—Å–∞.

## –°—Ç–µ–∫
- Java 21, Spring Boot 3.3
- Spring Web, Security (JWT), Validation
- Spring JDBC (JdbcTemplate)
- PostgreSQL 16, Liquibase (–º–∏–≥—Ä–∞—Ü–∏–∏)
- Swagger/OpenAPI 3 (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API)
- Outbox-—à–∏–Ω–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π (1–°, —Ç–µ–ª–µ–º–∞—Ç–∏–∫–∞)

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: Docker —Å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–º–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫:
**Windows:**
```bash
demo-setup.bat
```

**Linux/Mac:**
```bash
chmod +x demo-setup.sh
./demo-setup.sh
```

#### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫:
```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ —Å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–º–∏
docker-compose up --build -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f app

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

1. –ü–æ–¥–Ω–∏–º–∏—Ç–µ PostgreSQL:
```bash
docker compose up -d postgres
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–∏–ª–∏ –ø—Ä–∞–≤—å—Ç–µ `application.yml`):
```bash
export DB_URL=jdbc:postgresql://localhost:5432/agrocrm
export DB_USER=postgres
export DB_PASSWORD=postgres
export JWT_SECRET=change-me-super-secret-please-change
```

3. –ó–∞–ø—É—Å–∫:
```bash
mvn spring-boot:run
```

4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–º–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
```bash
psql -h localhost -U postgres -d agrocrm -f demo-data.sql
```

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:
- **Swagger UI**: http://localhost:8080/swagger-ui/index.html
- **OpenAPI JSON**: http://localhost:8080/v3/api-docs

## –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Å–µ—Ö: `password`)
- **admin** - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –°–∏—Å—Ç–µ–º—ã (IT)
- **agronom** - –ü–µ—Ç—Ä–æ–≤ –ò–≤–∞–Ω –°–µ—Ä–≥–µ–µ–≤–∏—á (–ê–≥—Ä–æ–Ω–æ–º–∏—è)
- **mechanic** - –°–∏–¥–æ—Ä–æ–≤ –ê–ª–µ–∫—Å–µ–π –ü–µ—Ç—Ä–æ–≤–∏—á (–ú–µ—Ö–∞–Ω–∏–∫–∞)
- **driver1** - –ö–æ–∑–ª–æ–≤ –ú–∏—Ö–∞–∏–ª –ò–≤–∞–Ω–æ–≤–∏—á (–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç)
- **driver2** - –ù–æ–≤–∏–∫–æ–≤ –î–º–∏—Ç—Ä–∏–π –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á (–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç)
- **accountant** - –ò–≤–∞–Ω–æ–≤–∞ –ï–ª–µ–Ω–∞ –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–Ω–∞ (–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è)
- **manager** - –°–º–∏—Ä–Ω–æ–≤ –ê–Ω–¥—Ä–µ–π –ù–∏–∫–æ–ª–∞–µ–≤–∏—á (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)

### –°–µ–ª—å—Å–∫–æ—Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–ª—è
- **–ü–æ–ª–µ ‚Ññ1 - –°–µ–≤–µ—Ä–Ω–æ–µ** (150.5 –≥–∞) - –ü—à–µ–Ω–∏—Ü–∞ –æ–∑–∏–º–∞—è
- **–ü–æ–ª–µ ‚Ññ2 - –í–æ—Å—Ç–æ—á–Ω–æ–µ** (200.0 –≥–∞) - –Ø—á–º–µ–Ω—å
- **–ü–æ–ª–µ ‚Ññ3 - –ó–∞–ø–∞–¥–Ω–æ–µ** (120.3 –≥–∞) - –ü–æ–¥—Å–æ–ª–Ω–µ—á–Ω–∏–∫
- **–ü–æ–ª–µ ‚Ññ4 - –Æ–∂–Ω–æ–µ** (180.7 –≥–∞) - –ö—É–∫—É—Ä—É–∑–∞
- **–ü–æ–ª–µ ‚Ññ5 - –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ** (95.2 –≥–∞) - –†–∞–ø—Å

### –¢–µ—Ö–Ω–∏–∫–∞
- **–ê123–ë–í77** - John Deere 8R 410 (–¢—Ä–∞–∫—Ç–æ—Ä)
- **–í456–ì–î78** - Case IH Magnum 400 (–¢—Ä–∞–∫—Ç–æ—Ä)
- **–ï789–ñ–ó79** - Claas Lexion 760 (–ö–æ–º–±–∞–π–Ω)
- **–ò012–ö–õ80** - Horsch Pronto 6DC (–ü–æ—Å–µ–≤–Ω–æ–π –∫–æ–º–ø–ª–µ–∫—Å)
- **–ú345–ù–û81** - Amazone UX 5200 (–û–ø—Ä—ã—Å–∫–∏–≤–∞—Ç–µ–ª—å)

### –ú–∞—Ç–µ—Ä–∏–∞–ª—ã
- –°–µ–º–µ–Ω–∞ –ø—à–µ–Ω–∏—Ü—ã, —è—á–º–µ–Ω—è, –ø–æ–¥—Å–æ–ª–Ω–µ—á–Ω–∏–∫–∞
- –ê–∑–æ—Ç–Ω—ã–µ –∏ —Ñ–æ—Å—Ñ–æ—Ä–Ω—ã–µ —É–¥–æ–±—Ä–µ–Ω–∏—è
- –ì–µ—Ä–±–∏—Ü–∏–¥ –†–∞—É–Ω–¥–∞–ø, –ò–Ω—Å–µ–∫—Ç–∏—Ü–∏–¥ –î–µ—Ü–∏—Å

### –ó–∞–¥–∞—á–∏
- ‚úÖ –ü–æ—Å–µ–≤ –ø—à–µ–Ω–∏—Ü—ã –æ–∑–∏–º–æ–π (–∑–∞–≤–µ—Ä—à–µ–Ω–∞)
- üîÑ –ü–æ—Å–µ–≤ —è—á–º–µ–Ω—è (–≤ —Ä–∞–±–æ—Ç–µ)
- üìÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–µ—Ä–±–∏—Ü–∏–¥–æ–º (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞)
- üìÖ –£–±–æ—Ä–∫–∞ –∫—É–∫—É—Ä—É–∑—ã (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞)
- üìÖ –í–Ω–µ—Å–µ–Ω–∏–µ —É–¥–æ–±—Ä–µ–Ω–∏–π (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞)

## –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (MVP)
- `POST /auth/login` ‚Üí JWT
- `GET/POST/PUT/DELETE /api/fields`
- `POST /api/tasks` (—Å–æ–∑–¥–∞–Ω–∏–µ)
- `POST /api/tasks/{id}/start|finish|cancel`
- `GET /api/tasks?status=IN_PROGRESS&fieldId=...`
- `POST /api/fuel/import` (–∑–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ì–°–ú, —á–µ—Ä–Ω–æ–≤–∏–∫)
- `GET /api/fuel/alerts/night`
- `GET /actuator/health`

## –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫–∞–∑—á–∏–∫—É

### –ß—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å:
1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É —á–µ—Ä–µ–∑ Swagger UI
2. **–ü–æ–ª—è** - `GET /api/fields` - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–µ–ª—å—Å–∫–æ—Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
3. **–ó–∞–¥–∞—á–∏** - `GET /api/tasks` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–ª—å—Å–∫–æ—Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏
4. **–ú–∞—Ç–µ—Ä–∏–∞–ª—ã** - `GET /api/materials` - –£—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ –∏—Ö –≤—ã–¥–∞—á–∞
5. **–ü—É—Ç–µ–≤—ã–µ –ª–∏—Å—Ç—ã** - `GET /api/waybills` - –î–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç —Ç–µ—Ö–Ω–∏–∫–∏
6. **–¢–æ–ø–ª–∏–≤–æ** - `GET /api/fuel/alerts/night` - –ö–æ–Ω—Ç—Ä–æ–ª—å —Ç–æ–ø–ª–∏–≤–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
7. **–¢–µ—Ö–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ** - `GET /api/maintenance/orders` - –ó–∞—è–≤–∫–∏ –Ω–∞ –¢–û
8. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - `GET /api/analytics/kpi/cost-per-ha` - –°—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –≥–µ–∫—Ç–∞—Ä

### –°—Ü–µ–Ω–∞—Ä–∏–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `demo-setup.bat` (Windows) –∏–ª–∏ `./demo-setup.sh` (Linux/Mac)
2. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8080/swagger-ui/index.html
3. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –∫–∞–∫ `admin` —Å –ø–∞—Ä–æ–ª–µ–º `password`
4. –ü–æ–∫–∞–∂–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã

## Docker –∫–æ–º–∞–Ω–¥—ã

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t agrocrm .

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose up -d postgres

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π
docker-compose up --build

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f app

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose down

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º volumes
docker-compose down -v
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Docker:
- `DB_URL` - URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `DB_USER` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î
- `DB_PASSWORD` - –ø–∞—Ä–æ–ª—å –ë–î
- `JWT_SECRET` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT

## –î–∞–ª—å—à–µ
- –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥—É–ª–∏: –ø—É—Ç–µ–≤—ã–µ –ª–∏—Å—Ç—ã, –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –¢–û/—Ä–µ–º–æ–Ω—Ç, –æ—Ç—á—ë—Ç—ã –∏ KPI.
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–∞—Ç—á–∏–Ω–≥ –ì–°–ú ‚Üî –ø—É—Ç–µ–≤—ã–µ –ª–∏—Å—Ç—ã ‚Üî —Ä–∞–±–æ—Ç—ã, –∞–ª–µ—Ä—Ç—ã.
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å 1–°: –∏–∑ outbox –≤ —à–∏–Ω—É/–æ—á–µ—Ä–µ–¥—å/HTTP, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤.
